const addBoundsPolygon=(e,t)=>{const l=cgpv.api.maps[e].transformAndDensifyExtent(t,`EPSG:${cgpv.api.maps[e].currentProjection}`,"EPSG:4326"),{geometry:n}=cgpv.api.maps[e].layer;n.setActiveGeometryGroup(),n.deleteGeometriesFromGroup(0);cgpv.api.maps[e].layer.geometry.addPolygon([l],{style:{strokeColor:"#000",strokeWidth:5,strokeOpacity:.8}})},createInfoTable=(e,t,l)=>{const n=document.getElementById(t);n.textContent="";const a=document.getElementById(`layer${e.slice(-1)}-info`);a&&a.remove();const d=document.createElement("div");d.id=`layer${e.slice(-1)}-info`,n.appendChild(d),Object.keys(l).forEach((t=>{const n=l[t].data,a=document.createElement("h1");if(a.innerText=n.length?t:`${t} (empty)`,d.appendChild(a),n.length){let t=document.createElement("h2");t.innerText="Aliases and types",d.appendChild(t);let l=document.createElement("table");l.classList.add("info"),d.appendChild(l);let a=document.createElement("tr");a.classList.add("info"),l.appendChild(a);let i=document.createElement("th");i.classList.add("infoCol1"),a.appendChild(i),Object.keys(n[0].fieldInfo).forEach((e=>{i=document.createElement("th"),i.classList.add("info"),i.innerText=e,a.appendChild(i)})),a=document.createElement("tr"),a.classList.add("info"),l.appendChild(a),i=document.createElement("td"),i.classList.add("infoCol1"),i.innerText="Aliases =>",a.appendChild(i),Object.keys(n[0].fieldInfo).forEach((e=>{i=document.createElement("td"),i.classList.add("info"),i.innerText=n[0].fieldInfo[e].alias,a.appendChild(i)})),a=document.createElement("tr"),a.classList.add("infoCol1"),l.appendChild(a),i=document.createElement("td"),i.classList.add("infoCol1"),i.innerText="Types =>",a.appendChild(i),Object.keys(n[0].fieldInfo).forEach((e=>{i=document.createElement("td"),i.classList.add("info"),i.innerText=n[0].fieldInfo[e].dataType,a.appendChild(i)})),t=document.createElement("h2"),t.innerText="Data",d.appendChild(t),l=document.createElement("table"),l.classList.add("info"),d.appendChild(l);let s=!0;n.forEach((t=>{s&&(a=document.createElement("tr"),a.classList.add("info"),l.appendChild(a),i=document.createElement("th"),i.classList.add("infoCol1"),i.innerText="Symbology",a.appendChild(i),i=document.createElement("th"),i.classList.add("infoCol1"),i.innerText="Zoom To",a.appendChild(i),Object.keys(t.fieldInfo).forEach((e=>{i=document.createElement("th"),i.classList.add("info"),i.innerText=e,a.appendChild(i)})),s=!1),a=document.createElement("tr"),a.classList.add("info"),l.appendChild(a),i=document.createElement("td"),i.classList.add("info"),i.appendChild(t.featureIcon),a.appendChild(i),i=document.createElement("td"),i.classList.add("info"),a.appendChild(i);const n=document.createElement("button");n.innerText="Zoom To Feature",n.addEventListener("click",(l=>{cgpv.api.maps[e].zoomToExtent(t.extent),addBoundsPolygon(e,t.extent)})),i.appendChild(n),Object.keys(t.fieldInfo).forEach((e=>{if(i=document.createElement("td"),i.classList.add("info"),"date"===t.fieldInfo[e].dataType){const{dateUtilities:l}=cgpv.api;i.innerText=t.fieldInfo[e].value}else i.innerText=t.fieldInfo[e].value;a.appendChild(i)}))}))}d.appendChild(document.createElement("br")),d.appendChild(document.createElement("hr"))}))},createTableOfFilter=e=>{let t=document.getElementById(`layer${e.slice(-1)}-buttons-pre`);const l=document.getElementById(`layer${e.slice(-1)}-buttons-table`);l&&l.remove();const n=document.createElement("table");n.id=`layer${e.slice(-1)}-buttons-table`,n.style.width="100%",n.border="1px solid black",t.appendChild(n),Object.keys(cgpv.api.maps[e].layer.geoviewLayers).forEach((l=>{const a=cgpv.api.maps[e].layer.geoviewLayers[l];Object.keys(cgpv.api.maps[e].layer.registeredLayers).forEach((d=>{if(d.startsWith(l)){const l=cgpv.api.maps[e].layer.registeredLayers[d],{geoviewRenderer:i}=cgpv.api.maps[e];i.getLegendStyles(l).then((d=>{t=document.createElement("td"),t.border="1px solid black",n.appendChild(t);const i=document.createElement("h1");i.innerText=a.geoviewLayerName.en,t.appendChild(i);const s=document.createElement("h2");s.innerText=`${l?.layerName?.en}`,s.style.height="15px",t.appendChild(s);const o=document.createElement("button");let c=a.getVisible(l);o.innerText=c?void 0===l?.source?.style?"Hide":`Hide style ${l.source.style}`:void 0===l?.source?.style?"Show":`Show style ${l.source.style}`,o.addEventListener("click",(e=>{c=!a.getVisible(l),o.innerText=c?void 0===l?.source?.style?"Hide":`Hide style ${l.source.style}`:void 0===l?.source?.style?"Show":`Show style ${l.source.style}`,a.setVisible(c,l)})),s.appendChild(o),l.style&&Object.keys(l.style).forEach((n=>{const i=document.createElement("p");if(i.innerText=`Geometry = ${n}`,i.style.height="15px",t.appendChild(i),"uniqueValue"===l.style[n].styleType){if(l.style[n].defaultSettings)if("always"===l.style[n].defaultVisible){const e=document.createElement("label");e.innerText="Always show ",e.style.fontSize="15px",e.style.height="15px",t.appendChild(e),t.appendChild(d[n].defaultCanvas);const l=document.createElement("br");l.style.height="1px",t.appendChild(l)}else{const i=document.createElement("button");"yes"===l.style[n].defaultVisible?i.innerText=`Hide ${l.style[n].defaultLabel}`:"no"===l.style[n].defaultVisible&&(i.innerText=`Show ${l.style[n].defaultLabel}`),i.addEventListener("click",(t=>{"yes"===l.style[n].defaultVisible?(l.style[n].defaultVisible="no",i.innerText=`Show ${l.style[n].defaultLabel}`):"no"===l.style[n].defaultVisible&&(l.style[n].defaultVisible="yes",i.innerText=`Hide ${l.style[n].defaultLabel}`);const d=document.getElementById(`checkbox-${e}-${a.geoviewLayerId}`),s=document.getElementById(`filter-input-${e}-${a.geoviewLayerId}`),o="true"===d.value?s.value:a.getLayerFilter(l);a.applyViewFilter(l,o,"true"!==d.value)})),t.appendChild(i),t.appendChild(d[n].defaultCanvas);const s=document.createElement("br");s.style.height="1px",t.appendChild(s)}for(let i=0;i<l.style[n].uniqueValueStyleInfo.length;i++)if("always"===l.style[n].uniqueValueStyleInfo[i].visible){const e=document.createElement("label");e.innerText="Always show ",e.style.fontSize="15px",t.appendChild(e),t.appendChild(d[n].arrayOfCanvas[i]);const l=document.createElement("br");l.style.height="1px",t.appendChild(l)}else{const s=document.createElement("button");"yes"===l.style[n].uniqueValueStyleInfo[i].visible?s.innerText=`Hide ${l.style[n].uniqueValueStyleInfo[i].label}`:"no"===l.style[n].uniqueValueStyleInfo[i].visible&&(s.innerText=`Show ${l.style[n].uniqueValueStyleInfo[i].label}`),s.addEventListener("click",(t=>{const d=l.style[n].uniqueValueStyleInfo[i];"yes"===d.visible?(d.visible="no",s.innerText=`Show ${d.label}`):"no"===d.visible&&(d.visible="yes",s.innerText=`Hide ${d.label}`);const o=document.getElementById(`checkbox-${e}-${a.geoviewLayerId}`),c=document.getElementById(`filter-input-${e}-${a.geoviewLayerId}`),r="true"===o.value?c.value:a.getLayerFilter(l);a.applyViewFilter(l,r,"true"!==o.value)})),t.appendChild(s),t.appendChild(d[n].arrayOfCanvas[i]);const o=document.createElement("br");o.style.height="1px",t.appendChild(o)}}else if("classBreaks"===l.style[n].styleType){if(l.style[n].defaultSettings)if("always"===l.style[n].defaultVisible){const e=document.createElement("label");e.innerText="Always show ",e.style.fontSize="15px",t.appendChild(e),t.appendChild(d[n].defaultCanvas);const l=document.createElement("br");l.style.height="1px",t.appendChild(l)}else{const d=document.createElement("button");"yes"===l.style[n].defaultVisible?d.innerText=`Hide ${l.style[n].defaultLabel}`:"no"===l.style[n].defaultVisible&&(d.innerText=`Show ${l.style[n].defaultLabel}`),d.addEventListener("click",(t=>{"yes"===l.style[n].defaultVisible?(l.style[n].defaultVisible="no",d.innerText=`Show ${l.style[n].defaultLabel}`):"no"===l.style[n].defaultVisible&&(l.style[n].defaultVisible="yes",d.innerText=`Hide ${l.style[n].defaultLabel}`);const i=document.getElementById(`checkbox-${e}-${a.geoviewLayerId}`),s=document.getElementById(`filter-input-${e}-${a.geoviewLayerId}`),o="true"===i.value?s.value:a.getLayerFilter(l);a.applyViewFilter(l,o,"true"!==i.value)})),t.appendChild(d);const i=document.createElement("br");i.style.height="1px",t.appendChild(i)}for(let i=0;i<l.style[n].classBreakStyleInfo.length;i++)if("always"===l.style[n].classBreakStyleInfo[i].visible){const e=document.createElement("label");e.innerText="Always show ",e.style.fontSize="15px",t.appendChild(e),t.appendChild(d[n].arrayOfCanvas[i]);const l=document.createElement("br");l.style.height="1px",t.appendChild(l)}else{const s=document.createElement("button");"yes"===l.style[n].classBreakStyleInfo[i].visible?s.innerText=`Hide ${l.style[n].classBreakStyleInfo[i].label}`:"no"===l.style[n].classBreakStyleInfo[i].visible&&(s.innerText=`Show ${l.style[n].classBreakStyleInfo[i].label}`),s.addEventListener("click",(t=>{const d=l.style[n].classBreakStyleInfo[i];"yes"===d.visible?(d.visible="no",s.innerText=`Show ${d.label}`):"no"===d.visible&&(d.visible="yes",s.innerText=`Hide ${d.label}`);const o=document.getElementById(`checkbox-${e}-${a.geoviewLayerId}`),c=document.getElementById(`filter-input-${e}-${a.geoviewLayerId}`),r="true"===o.value?c.value:a.getLayerFilter(l);a.applyViewFilter(l,r,"true"!==o.value)})),t.appendChild(s),t.appendChild(d[n].arrayOfCanvas[i]);const o=document.createElement("br");o.style.height="1px",t.appendChild(o)}}if(a.getLayerFilter){const n=document.createElement("p");n.innerText="Extra filter: ",t.appendChild(n);const d=document.createElement("input");d.id=`filter-input-${e}-${a.geoviewLayerId}`,d.style.width="50%",n.appendChild(d),d.value=a.getLayerFilter(l)||"";const i=document.createElement("button");i.addEventListener("click",(t=>{const n=document.getElementById(`checkbox-${e}-${a.geoviewLayerId}`);a.applyViewFilter(l,d.value,"true"!==n.value)})),i.innerText="Apply",n.style.width="max-content",n.appendChild(i);const s=document.createElement("input");s.type="checkbox",s.value="false",s.id=`checkbox-${e}-${a.geoviewLayerId}`,s.addEventListener("click",(e=>{s.value="true"===s.value?"false":"true",a.applyViewFilter(l,d.value,"true"!==s.value)})),t.appendChild(s);const o=document.createElement("label");o.innerText="apply only the extra filter",t.appendChild(o)}}))}))}}))}))};function displayLegend(e,t){const l=(e,t)=>{const l=document.createElement("th");l.style="text-align: center; vertical-align: middle;",l.innerHTML=e,t.appendChild(l)},n=(e,t)=>{const l=document.createElement("td");l.style.verticalAlign="middle",l.style.textAlign="center",e?"string"==typeof e?l.innerHTML=e.replaceAll("<","&lt;").replaceAll(">","&gt;"):l.appendChild(e):l.innerHTML="NO LEGEND",t.appendChild(l)},a=document.getElementById(`${e}-table`);a&&a.parentNode.removeChild(a);const d=document.getElementById(`${e}-table-pre`),i=document.createElement("table");i.id=`${e}-table`,i.border="1",i.style="width:50%",d.appendChild(i);let s=!0;Object.keys(t).forEach((e=>{const a=t[e];if("processed"===a.layerStatus&&a?.data?.legend)if("ogcWms"===a.data?.type||"imageStatic"===a.data?.type){if(s){s=!1;const e=document.createElement("tr");i.appendChild(e),l("Layer Path",e),l("Symbology",e)}const e=document.createElement("tr");n(a.data.layerPath,e),n(a.data.legend,e),i.appendChild(e)}else{const t=(e,t,l)=>{const a=document.createElement("tr");n(e,a),n(t,a),n(l,a),i.appendChild(a)};if(s){s=!1;const e=document.createElement("tr");i.appendChild(e),l("Layer Path",e),l("Label",e),l("Symbology",e)}a.data?.legend&&Object.keys(a.data.legend).forEach((l=>{if(l)if("uniqueValue"===a.data.styleConfig[l].styleType){a.data.legend[l].defaultCanvas&&t(e,a.data.styleConfig[l].defaultLabel,a.data.legend[l].defaultCanvas);for(let n=0;n<a.data.legend[l].arrayOfCanvas.length;n++)t(e,a.data.styleConfig[l].uniqueValueStyleInfo[n].label,a.data.legend[l].arrayOfCanvas[n])}else if("classBreaks"===a.data.styleConfig[l].styleType){a.data.legend[l].defaultCanvas&&t(e,a.data.styleConfig[l].defaultLabel,a.data.legend[l].defaultCanvas);for(let n=0;n<a.data.legend[l].arrayOfCanvas.length;n++)t(e,a.data.styleConfig[l].classBreakStyleInfo[n].label,a.data.legend[l].arrayOfCanvas[n])}else"simple"===a.data.styleConfig[l].styleType&&t(e,a.data.styleConfig[l].label,a.data.legend[l].defaultCanvas)}))}else{if(s){s=!1;const e=document.createElement("tr");i.appendChild(e),l("Layer Path",e),l("Status",e)}const t=document.createElement("tr");n(e,t);let d=void 0===a.data&&"processed"===a.layerStatus?"(waiting for legend)":"";d=null===a.data&&"processed"===a.layerStatus?"(legend fetch error)":d,d=a.data&&!a.data.legend&&"processed"===a.layerStatus?"(no legend)":d,n(`${a.layerStatus} ${d}`,t),i.appendChild(t)}}))}