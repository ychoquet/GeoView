/*! Package:geoview-footer-panel: 0.1.0 - "3166bca63fc91f2a54ce9e77d6a3abca7e4153be" - 2023-02-21T16:01:45.939Z */
"use strict";(self.webpackChunkgeoview_core=self.webpackChunkgeoview_core||[]).push([[435],{40950:(e,t,a)=>{var n=a(81744),r=a(56805),o=a(9750),i=a(9018),s=a(30693),l=a(56367),u=a(22471),c=a(33719);const f=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"GeoView Footer Config Schema","type":"object","version":1,"comments":"Configuration for GeoView footer package.","additionalProperties":true,"properties":{"tabs":{"type":"object","description":"Available tabs","properties":{"defaultTabs":{"type":"array","items":{"type":"string","enum":["legend","details","data-grid"]},"minItems":0,"default":["legend","details","data-grid"],"uniqueItems":true,"description":"Defaut tabs of footer panel to use"},"customTabs":{"type":"array","items":{"type":"object","properties":{"defaultTabs":{"type":"string"},"contentHTML":{"type":"string"}}},"minItems":0,"default":[],"uniqueItems":true,"description":"Custom tabs of footer panel to use"}},"additionalProperties":false},"suportedLanguages":{"type":"array","uniqueItems":true,"items":{"type":"string","enum":["en","fr"]},"default":["en","fr"],"description":"ISO 639-1 code indicating the languages supported by the configuration file.","minItems":1},"version":{"type":"string","enum":["1.0"],"description":"The schema version used to validate the configuration file. The schema should enumerate the list of versions accepted by this version of the viewer."},"collapsed":{"type":"boolean","default":true,"description":"State of footer panel when map is loaded"}},"required":["suportedLanguages","tabs"]}'),d=JSON.parse('{"tabs":{"defaultTabs":["legend","details","data-grid"],"customTabs":[]},"suportedLanguages":["en","fr"]}');var p=a(82482),v=a(45202),g=window;function m(e){var t=e.mapId,a=g.cgpv,n=a.api,r=a.react,o=r.useState,i=r.useEffect,s=o([]),l=(0,p.Z)(s,2),u=l[0],f=l[1],d=o(),m=(0,p.Z)(d,2),E=m[0],y=m[1],b=o([]),h=(0,p.Z)(b,2),L=h[0],I=h[1],N=o(null),T=(0,p.Z)(N,2),_=T[0],w=T[1];return i((function(){return n.event.on(n.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE,(function(e){if((0,c.gNW)(e)){var a=e.resultSets,r=[];Object.keys(a).forEach((function(e){var o=(0,c.dIw)(n.map(t).layer.registeredLayers[e].layerName,t),i=a[e];i.length>0&&r.push({layerPath:e,layerName:o,features:i})})),r.length>0?f(r):f([])}else f([])}),t,"".concat(t,"-DetailsAPI")),n.event.on(n.eventNames.MAP.EVENT_MAP_SINGLE_CLICK,(function(e){if((0,c.yp4)(e)){var t=e.coordinates;w(e.handlerName),I(t.lnglat)}else I([])}),t),function(){n.event.off(n.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE,t),n.event.off(n.eventNames.MAP.EVENT_MAP_SINGLE_CLICK,t)}}),[]),i((function(){y(n.map(t).details.createDetails(t,u,{mapId:t,location:L,handlerName:_}))}),[u,L]),(0,v.jsx)("div",{children:E})}var E=a(91142),y=window;function b(e){var t=e.mapId,a=y.cgpv,n=a.api,r=a.react,o=r.useState,i=r.useEffect,s=o(),l=(0,p.Z)(s,2),u=l[0],f=l[1],d=o([]),g=(0,p.Z)(d,2),m=g[0],b=g[1];return i((function(){return b(Object.keys(n.map(t).layer.geoviewLayers)),n.event.on(n.eventNames.LAYER.EVENT_REMOVE_LAYER,(function(e){var t;(0,c.UKz)(e)&&(t=e.geoviewLayer.geoviewLayerId,b((function(e){return e.filter((function(e){return e!==t}))})))}),t),n.event.on(n.eventNames.LAYER.EVENT_ADD_LAYER,(function(e){(0,c.riW)(e)&&n.event.on(n.eventNames.LAYER.EVENT_LAYER_ADDED,(function(){var a;a=e.layerConfig.geoviewLayerId,Object.keys(n.map(t).layer.geoviewLayers).includes(a)?b((function(e){return[a].concat((0,E.Z)(e))})):console.error("geoviewLayerId is not in the layers list"),n.event.off(n.eventNames.LAYER.EVENT_LAYER_ADDED,t,e.layerConfig.geoviewLayerId)}),t,e.layerConfig.geoviewLayerId)}),t),function(){n.event.off(n.eventNames.LAYER.EVENT_ADD_LAYER,t),n.event.off(n.eventNames.LAYER.EVENT_REMOVE_LAYER,t)}}),[]),i((function(){f(n.map(t).legend.createLegend({layerIds:m}))}),[m]),(0,v.jsx)("div",{children:u})}var h=window;function L(e){var t=e.mapId,a=h.cgpv,n=a.api,r=a.ui,o=a.react,i=r.elements.Tabs,s=o.useState,l=o.useEffect,u=s([]),f=(0,p.Z)(u,2),d=f[0],g=f[1];return l((function(){g(Object.keys(n.map(t).layer.geoviewLayers))}),[]),(0,v.jsx)(i,{tabsProps:{variant:"scrollable"},tabs:d.map((function(e,a){var r=n.map(t).layer.geoviewLayers[e],o=(0,c.dIw)(r.geoviewLayerName,t);return{value:a,label:void 0!==o?o:"data-".concat(a),content:function(){return n.map(t).dataGrid.createDataGrid({layerId:e}).then((function(e){return e}))}}}))})}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,l.Z)(e);if(t){var r=(0,l.Z)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,s.Z)(this,a)}}var N=window,T=function(e){(0,i.Z)(a,e);var t=I(a);function a(e,r){var i;return(0,n.Z)(this,a),i=t.call(this,e,r),(0,u.Z)((0,o.Z)(i),"schema",(function(){return f})),(0,u.Z)((0,o.Z)(i),"defaultConfig",(function(){return(0,c.ZQJ)(d)})),(0,u.Z)((0,o.Z)(i),"translations",(0,c.ZQJ)({en:{legend:"Legend",details:"Details",dataGrid:"Data"},fr:{legend:"Légende",details:"Détails",dataGrid:"Données"}})),(0,u.Z)((0,o.Z)(i),"added",(function(){var e=(0,o.Z)(i),t=e.configObj,a=e.pluginProps.mapId,n=N.cgpv;if(n){var r=n.api,s=r.map(a),l=s.displayLanguage,u=s.footerTabs,f=s.map.getTargetElement().parentElement;f&&(!1===(null==t?void 0:t.collapsed)?f.style.height="calc( 100% - 300px )":f.style.height="calc( 100% - 55px )");var d=null==t?void 0:t.tabs.defaultTabs,p=0;if(d.includes("legend")&&(u.createFooterTab({value:p,label:i.translations[l].legend,content:function(){return(0,v.jsx)(b,{mapId:a})}}),p++),d.includes("details")){var g=p;u.createFooterTab({value:g,label:i.translations[l].details,content:function(){return(0,v.jsx)(m,{mapId:a})}}),p++,r.event.on(r.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE,(function(e){if((0,c.gNW)(e)){var t=e.resultSets,a=[];Object.keys(t).forEach((function(e){a=a.concat(t[e])})),a.length>0&&u.selectFooterTab(g)}}),a,"".concat(a,"-DetailsAPI"))}d.includes("data-grid")&&(u.createFooterTab({value:p,label:i.translations[l].dataGrid,content:function(){return(0,v.jsx)(L,{mapId:a})}}),p++);for(var E=null==t?void 0:t.tabs.customTabs,y=0;y<E.length;y++){var h=E[y];u.createFooterTab({value:p,label:h.title,content:h.contentHTML}),p++}}})),i.buttonPanel=null,i}return(0,r.Z)(a,[{key:"removed",value:function(){N.cgpv}}]),a}(c.Vw$);N.plugins=N.plugins||{},N.plugins["footer-panel"]=(0,c.RFZ)(T)}},e=>{var t;t=40950,e(e.s=t)}]);
//# sourceMappingURL=geoview-footer-panel.js.map