{"version":3,"file":"corePackages/geoview-footer-panel.js","mappings":"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","sources":["webpack://geoview-core/../geoview-footer-panel/src/details-item.tsx","webpack://geoview-core/../geoview-footer-panel/src/index.tsx"],"sourcesContent":["/* eslint-disable react/require-default-props */\r\nimport { ReactElement } from 'react';\r\n\r\nimport { TypeWindow, payloadIsAllQueriesDone, TypeArrayOfLayerData, getLocalizedValue } from 'geoview-core';\r\n\r\ninterface Props {\r\n  mapId: string;\r\n}\r\nconst w = window as TypeWindow;\r\n\r\n/**\r\n * Create an element that displays the details component\r\n *\r\n * @returns {JSX.Element} created details component\r\n */\r\nexport function DetailsItem({ mapId }: Props): JSX.Element {\r\n  const { cgpv } = w;\r\n  const { api, react } = cgpv;\r\n\r\n  const { useState, useEffect } = react;\r\n\r\n  const [details, setDetails] = useState<TypeArrayOfLayerData>([]);\r\n  // eslint-disable-next-line @typescript-eslint/ban-types\r\n  const [list, setList] = useState<ReactElement>();\r\n\r\n  useEffect(() => {\r\n    // create the listener to return the details\r\n    api.event.on(\r\n      api.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE,\r\n      (payload) => {\r\n        if (payloadIsAllQueriesDone(payload)) {\r\n          const { resultSets } = payload;\r\n          const newDetails: TypeArrayOfLayerData = [];\r\n          Object.keys(resultSets).forEach((layerPath) => {\r\n            const layerName = getLocalizedValue(api.map(mapId).layer.registeredLayers[layerPath].layerName, mapId)!;\r\n            const features = resultSets[layerPath]!;\r\n            if (features.length > 0) {\r\n              newDetails.push({ layerPath, layerName, features });\r\n            }\r\n          });\r\n          if (newDetails.length > 0) {\r\n            setDetails(newDetails);\r\n          } else {\r\n            setDetails([]);\r\n          }\r\n        } else {\r\n          setDetails([]);\r\n        }\r\n      },\r\n      mapId,\r\n      `${mapId}-DetailsAPI`\r\n    );\r\n    return () => {\r\n      api.event.off(api.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE, mapId);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    setList(api.map(mapId).details.createDetails(mapId, details));\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [details]);\r\n\r\n  return <div>{list}</div>;\r\n}\r\n","import {\r\n  Cast,\r\n  AbstractPlugin,\r\n  TypePluginOptions,\r\n  TypeButtonPanel,\r\n  TypeWindow,\r\n  toJsonObject,\r\n  TypeJsonObject,\r\n  AnySchemaObject,\r\n} from 'geoview-core';\r\n\r\nimport schema from '../schema.json';\r\nimport defaultConfig from '../default-config-footer-panel.json';\r\nimport { DetailsItem } from './details-item';\r\n\r\nconst w = window as TypeWindow;\r\n\r\ntype CustomTabs = {\r\n  title: string;\r\n  contentHTML: string;\r\n};\r\n\r\n/**\r\n * Create a class for the plugin instance\r\n */\r\nclass FooterPanelPlugin extends AbstractPlugin {\r\n  // store the created button panel object\r\n  buttonPanel: TypeButtonPanel | null;\r\n\r\n  constructor(pluginId: string, props: TypePluginOptions) {\r\n    super(pluginId, props);\r\n    this.buttonPanel = null;\r\n  }\r\n\r\n  /**\r\n   * Return the package schema\r\n   *\r\n   * @returns {AnySchemaObject} the package schema\r\n   */\r\n  schema = (): AnySchemaObject => schema;\r\n\r\n  /**\r\n   * Return the default config for this package\r\n   *\r\n   * @returns {TypeJsonObject} the default config\r\n   */\r\n  defaultConfig = (): TypeJsonObject => toJsonObject(defaultConfig);\r\n\r\n  /**\r\n   * translations object to inject to the viewer translations\r\n   */\r\n  translations = toJsonObject({\r\n    en: {\r\n      legend: 'Legend',\r\n      details: 'Details',\r\n      dataGrid: 'Data',\r\n    },\r\n    fr: {\r\n      legend: 'Légende',\r\n      details: 'Détails',\r\n      dataGrid: 'Données',\r\n    },\r\n  });\r\n\r\n  /**\r\n   * Added function called after the plugin has been initialized\r\n   */\r\n  added = (): void => {\r\n    const { configObj, pluginProps } = this;\r\n\r\n    const { mapId } = pluginProps;\r\n\r\n    // access the cgpv object from the window object\r\n    const { cgpv } = w;\r\n\r\n    if (cgpv) {\r\n      // access the api calls\r\n      const { api } = cgpv;\r\n      const { displayLanguage } = api.map(mapId);\r\n      const { footerTabs } = api.map(mapId);\r\n\r\n      const defaultTabs = configObj?.tabs.defaultTabs as Array<string>;\r\n      let tabsCounter = 0;\r\n\r\n      if (defaultTabs.includes('legend')) {\r\n        // create new tab and add the LegendComponent to the footer tab\r\n        footerTabs.createFooterTab({\r\n          value: tabsCounter,\r\n          label: this.translations[displayLanguage].legend as string,\r\n          content: () => api.map(mapId).legend.createLegend({ layerIds: ['esriFeatureLYR4'] }),\r\n        });\r\n        tabsCounter++;\r\n      }\r\n\r\n      // create the listener to return the details\r\n      if (defaultTabs.includes('details')) {\r\n        // the call to create details element return the element and the footer content is waiting for a function.\r\n        footerTabs.createFooterTab({\r\n          value: tabsCounter,\r\n          label: this.translations[displayLanguage].details as string,\r\n          content: () => <DetailsItem mapId={mapId} />,\r\n        });\r\n        tabsCounter++;\r\n      }\r\n\r\n      if (defaultTabs.includes('data-grid')) {\r\n        // the call to create data grid element return the element and the footer content is waiting for a function.\r\n        footerTabs.createFooterTab({\r\n          value: tabsCounter,\r\n          label: this.translations[displayLanguage].dataGrid as string,\r\n          content: () => api.map(mapId).dataGrid.createDataGrid({ layerId: 'esriFeatureLYR4' }),\r\n        });\r\n        tabsCounter++;\r\n      }\r\n\r\n      // TODO add custom detail reusable component when done\r\n\r\n      const customTabs = configObj?.tabs.customTabs as Array<string>;\r\n      for (let i = 0; i < customTabs.length; i++) {\r\n        const tab = customTabs[i] as unknown as CustomTabs;\r\n\r\n        footerTabs.createFooterTab({\r\n          value: tabsCounter,\r\n          label: tab.title,\r\n          content: tab.contentHTML,\r\n        });\r\n        tabsCounter++;\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Function called when the plugin is removed, used for clean up\r\n   */\r\n  removed(): void {\r\n    // const { mapId } = this.pluginProps;\r\n\r\n    // access the cgpv object from the window object\r\n    const { cgpv } = w;\r\n\r\n    if (cgpv) {\r\n      // access the api calls\r\n      // const { api } = cgpv;\r\n      // TODO: Enable the footer tabs removal\r\n    }\r\n  }\r\n}\r\n\r\nexport default FooterPanelPlugin;\r\n\r\nw.plugins = w.plugins || {};\r\nw.plugins['footer-panel'] = Cast<AbstractPlugin>(FooterPanelPlugin);\r\n"],"names":["w","window","DetailsItem","mapId","cgpv","api","react","useState","useEffect","details","setDetails","list","setList","event","on","eventNames","GET_FEATURE_INFO","ALL_QUERIES_DONE","payload","payloadIsAllQueriesDone","resultSets","newDetails","Object","keys","forEach","layerPath","layerName","getLocalizedValue","map","layer","registeredLayers","features","length","push","off","createDetails","FooterPanelPlugin","pluginId","props","schema","toJsonObject","defaultConfig","en","legend","dataGrid","fr","configObj","pluginProps","displayLanguage","footerTabs","defaultTabs","tabs","tabsCounter","includes","createFooterTab","value","label","translations","content","createLegend","layerIds","createDataGrid","layerId","customTabs","i","tab","title","contentHTML","buttonPanel","AbstractPlugin","plugins","Cast"],"sourceRoot":""}