{"version":3,"file":"corePackages/geoview-details-panel.js","mappings":"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","sources":["webpack://geoview-core/../geoview-details-panel/src/details-item.tsx","webpack://geoview-core/../geoview-details-panel/src/index.tsx"],"sourcesContent":["/* eslint-disable react/require-default-props */\nimport type React from 'react';\nimport { PayloadBaseClass } from 'geoview-core/src/api/events/payloads';\nimport {\n  TypeAllQueriesDonePayload,\n  MapMouseEventPayload,\n  TypeWindow,\n  payloadIsAMapMouseEvent,\n  payloadIsAllQueriesDone,\n  TypeArrayOfLayerData,\n  getLocalizedValue,\n  Coordinate,\n} from 'geoview-core';\n\ninterface Props {\n  mapId: string;\n  buttonId?: string;\n}\n\nconst w = window as TypeWindow;\n\n/**\n * Create an element that displays the details component\n *\n * @returns {JSX.Element} created details component\n */\nexport function DetailsItem({ mapId, buttonId }: Props): JSX.Element {\n  const { cgpv } = w;\n  const { api, react } = cgpv;\n\n  const { useState, useEffect } = react;\n\n  const [details, setDetails] = useState<TypeArrayOfLayerData>([]);\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  const [list, setList] = useState<React.ReactElement>();\n  const [LngLat, setLngLat] = useState<Coordinate>([]);\n  const [handlerName, setHandlerName] = useState<string | null>(null);\n\n  const panel = api.maps[mapId].appBarButtons.getAppBarButtonPanelById(buttonId === undefined ? '' : buttonId)?.panel;\n\n  const allQueriesDoneListenerFunction = (payload: PayloadBaseClass) => {\n    if (payloadIsAllQueriesDone(payload)) {\n      const { resultSets } = payload as TypeAllQueriesDonePayload;\n      const newDetails: TypeArrayOfLayerData = [];\n      Object.keys(resultSets).forEach((layerPath) => {\n        const layerName = getLocalizedValue(api.maps[mapId].layer.registeredLayers[layerPath].layerName, mapId)!;\n        const features = resultSets[layerPath]!.data;\n        if (features.length > 0) {\n          newDetails.push({ layerPath, layerName, features });\n        }\n      });\n      if (newDetails.length > 0) {\n        setDetails(newDetails);\n        // open the details panel\n        panel?.open();\n      } else {\n        setDetails([]);\n      }\n    } else {\n      setDetails([]);\n    }\n  };\n\n  const eventMapSingleClickListenerFunction = (payload: PayloadBaseClass) => {\n    if (payloadIsAMapMouseEvent(payload)) {\n      const { coordinates } = payload as MapMouseEventPayload;\n      setHandlerName(payload.handlerName);\n      setLngLat(coordinates.lnglat);\n    } else {\n      setLngLat([]);\n    }\n  };\n\n  useEffect(() => {\n    // create the listener to return the details\n    api.event.on(api.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE, allQueriesDoneListenerFunction, `${mapId}/$FeatureInfoLayerSet$`);\n    // get click info.\n    api.event.on(api.eventNames.MAP.EVENT_MAP_SINGLE_CLICK, eventMapSingleClickListenerFunction, mapId);\n\n    return () => {\n      api.event.off(api.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE, mapId, allQueriesDoneListenerFunction);\n      api.event.off(api.eventNames.MAP.EVENT_MAP_SINGLE_CLICK, mapId, eventMapSingleClickListenerFunction);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    setList(\n      api.maps[mapId].details.createDetails(mapId, details, {\n        mapId,\n        location: LngLat,\n        backgroundStyle: 'dark',\n        singleColumn: true,\n        handlerName,\n      })\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [details, LngLat]);\n\n  return <div>{list}</div>;\n}\n","/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\nimport {\n  AbstractPlugin,\n  toJsonObject,\n  TypeJsonObject,\n  TypeWindow,\n  TypePluginOptions,\n  TypeButtonPanel,\n  TypeIconButtonProps,\n  TypePanelProps,\n  AnySchemaObject,\n} from 'geoview-core';\nimport { DetailsItem } from './details-item';\n\nimport schema from '../schema.json';\nimport defaultConfig from '../default-config-details-panel.json';\n\nconst w = window as TypeWindow;\n\n/**\n * Create a class for the plugin instance\n */\nclass DetailsPlugin extends AbstractPlugin {\n  // store the created button panel object\n  buttonPanel: TypeButtonPanel | null;\n\n  constructor(pluginId: string, props: TypePluginOptions) {\n    super(pluginId, props);\n    this.buttonPanel = null;\n  }\n\n  /**\n   * Return the schema that is defined for this package\n   *\n   * @returns {AnySchemaObject} returns the schema for this package\n   */\n  schema = (): AnySchemaObject => schema;\n\n  /**\n   * Return the default config for this package\n   *\n   * @returns {TypeJsonObject} the default config\n   */\n  defaultConfig = (): TypeJsonObject => toJsonObject(defaultConfig);\n\n  /**\n   * translations object to inject to the viewer translations\n   */\n  translations = toJsonObject({\n    en: {\n      detailsPanel: 'Details',\n      nothing_found: 'Nothing found',\n      click_map: 'Choose a point on the map to start',\n      action_back: 'Back',\n    },\n    fr: {\n      detailsPanel: 'Détails',\n      nothing_found: 'Aucun résultat',\n      click_map: 'Choisissez un point sur la carte pour commencer',\n      action_back: 'Retour',\n    },\n  });\n\n  /**\n   * Added function called after the plugin has been initialized\n   */\n  added(): void {\n    const { mapId } = (this as AbstractPlugin).pluginProps;\n\n    // access the cgpv object from the window object\n    const { cgpv } = w;\n\n    // access the api calls\n    const { api, ui } = cgpv;\n    const { DetailsIcon } = ui.elements;\n    const { displayLanguage } = api.maps[mapId];\n\n    // button props\n    const button: TypeIconButtonProps = {\n      id: 'detailsPanelButton',\n      tooltip: this.translations[displayLanguage].detailsPanel as string,\n      tooltipPlacement: 'right',\n      children: <DetailsIcon />,\n      visible: true,\n    };\n\n    // panel props\n    const panel: TypePanelProps = {\n      title: this.translations[displayLanguage].detailsPanel,\n      icon: '<i class=\"material-icons\">details</i>',\n      width: 350,\n    };\n\n    // create a new button panel on the app-bar\n    this.buttonPanel = api.maps[mapId].appBarButtons.createAppbarPanel(button, panel, null);\n\n    // set panel content\n    this.buttonPanel?.panel?.changeContent(<DetailsItem mapId={mapId} buttonId={button.id} />);\n  }\n\n  /**\n   * Function called when the plugin is removed, used for clean up\n   */\n  removed(): void {\n    const { mapId } = (this as AbstractPlugin).pluginProps;\n\n    // access the cgpv object from the window object\n    const { cgpv } = w;\n\n    // access the api calls\n    const { api } = cgpv;\n\n    if (this.buttonPanel) {\n      api.maps[mapId as string].appBarButtons.removeAppbarPanel(this.buttonPanel.buttonPanelId);\n    }\n  }\n}\n\nexport default DetailsPlugin;\n\nw.plugins = w.plugins || {};\nw.plugins['details-panel'] = DetailsPlugin as AbstractPlugin;\n"],"names":["w","window","DetailsItem","_ref","_api$maps$mapId$appBa","mapId","buttonId","cgpv","api","react","useState","useEffect","_useState","_useState2","_slicedToArray","details","setDetails","_useState3","_useState4","list","setList","_useState5","_useState6","LngLat","setLngLat","_useState7","_useState8","handlerName","setHandlerName","panel","maps","appBarButtons","getAppBarButtonPanelById","undefined","allQueriesDoneListenerFunction","payload","payloadIsAllQueriesDone","resultSets","newDetails","Object","keys","forEach","layerPath","layerName","getLocalizedValue","layer","registeredLayers","features","data","length","push","open","eventMapSingleClickListenerFunction","payloadIsAMapMouseEvent","coordinates","lnglat","event","on","eventNames","GET_FEATURE_INFO","ALL_QUERIES_DONE","concat","MAP","EVENT_MAP_SINGLE_CLICK","off","createDetails","location","backgroundStyle","singleColumn","_jsx","children","DetailsPlugin","_AbstractPlugin","_inherits","_super","_createSuper","pluginId","props","_this","_classCallCheck","call","_defineProperty","_assertThisInitialized","schema","toJsonObject","defaultConfig","en","detailsPanel","nothing_found","click_map","action_back","fr","buttonPanel","_createClass","key","value","_this$buttonPanel","this","pluginProps","DetailsIcon","ui","elements","displayLanguage","button","id","tooltip","translations","tooltipPlacement","visible","title","icon","width","createAppbarPanel","changeContent","removeAppbarPanel","buttonPanelId","AbstractPlugin","plugins"],"sourceRoot":""}